import os
import sys

sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '../')))

from exploit.bof_exploit import OverflowExploit
from exploit.string_bug import FormatStringExploit
from dispatcher import Dispatcher

class Exploit:
    def __init__(self, config : dict[str, str | bool | int]):
        self.config : dict[str, str | bool | int] = config
        self.dispatcher : Dispatcher = Dispatcher(self.config)
        if not self.dispatcher.is_connected():
            self.dispatcher.connect()

    def run_bof_exploit(self):
        bof_exploit = OverflowExploit(self.config, self.dispatcher)
        bof_index = bof_exploit.try_overflow()
        return bof_index

    def run_string_bug_exploit(self):
        string_exploit = FormatStringExploit(self.config, self.dispatcher)
        return string_exploit.find_offset(max_offset=100)